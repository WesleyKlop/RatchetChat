#!/usr/bin/php
<?php
use Chat\Chat;
use Chat\Config\Config;
use Ratchet\Http\HttpServer;
use Ratchet\Server\IoServer;
use Ratchet\Session\SessionProvider;
use Ratchet\WebSocket\WsServer;

require_once __DIR__ . '/../vendor/autoload.php';

$server = IoServer::factory(
    new HttpServer(
        new WsServer(
            new SessionProvider(
                new Chat(),
                new SessionHandler()
            )
        )
    ),
    Config::get('app.port')
);

echo shell_exec('clear');
echo "Starting websocket server on " . Config::get('app.host') . ':' . Config::get('app.port') . PHP_EOL;

$server->run();